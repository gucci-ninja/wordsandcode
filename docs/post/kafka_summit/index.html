<!doctype html>
<html lang="en-us">
  <head>
    <title>Kafka Summit Tech Talk // Words &amp; Code</title>
    <link rel="shortcut icon" href="https://pngimage.net/wp-content/uploads/2018/05/bullet-style-png-3-300x200.png" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.134.1">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Suhavi Sandhu" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/wordsandcode/css/main.min.a7dfeaabca38e15028cf2fc45c1eca64f842bd62529f0bf081a55d5270f9d37a.css" />
    

    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Kafka Summit Tech Talk">
  <meta name="twitter:description" content="For those interested, I gave a talk at the Kafka APAC Summit in 2021 on how to leverage Kafka for decentralized applications. The video is still up on confluentâ€™s website but I went and added most of the topics I discussed here.
What is a decentralized app (DApp) Decentralized applications are programs that leverage a blockchain or peer-to-peer network to give users more control of their data. Decentralized applications are not really that new, you might have heard of some popular ones or even used them like BitTorrent. It uses the feeding and seeding model, where file sharing is made possible by users who volunteer to transfer their data to others and those users who propagate the data forwards by becoming seeders for the file.">

    <meta property="og:url" content="https://gucci-ninja.github.io/wordsandcode/post/kafka_summit/">
  <meta property="og:site_name" content="Words & Code">
  <meta property="og:title" content="Kafka Summit Tech Talk">
  <meta property="og:description" content="For those interested, I gave a talk at the Kafka APAC Summit in 2021 on how to leverage Kafka for decentralized applications. The video is still up on confluentâ€™s website but I went and added most of the topics I discussed here.
What is a decentralized app (DApp) Decentralized applications are programs that leverage a blockchain or peer-to-peer network to give users more control of their data. Decentralized applications are not really that new, you might have heard of some popular ones or even used them like BitTorrent. It uses the feeding and seeding model, where file sharing is made possible by users who volunteer to transfer their data to others and those users who propagate the data forwards by becoming seeders for the file.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2021-09-16T22:08:17-05:00">
    <meta property="article:modified_time" content="2021-09-16T22:08:17-05:00">


  </head>
  <body>
    <header class="app-header">
      <a href="/wordsandcode/"><img class="app-header-avatar" src="/wordsandcode/img/avatar.jpg" alt="Suhavi Sandhu" /></a>
      <span class="app-header-title">Words &amp; Code</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/wordsandcode/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/about/">About</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/design_review_tips/">8 Tips for Effective Design Reviews</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/thanksgiving/">A-Z Tech to be thankful for in 2020</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/ai_abc/">AI ABCs</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/elastic_cc/">Elastic Community Conference Tech Talk</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/flutter_rive_tutorial/">Flutter Web and Rive Animation Tutorial</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/archero/">How I Built an AI Assistant for my Operating System</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/open_source/">How to start contributing to open source</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/kafka_summit/">Kafka Summit Tech Talk</a>
             - 
          
          <a class="app-header-menu-item" href="/wordsandcode/post/arch_linux/">Your Guide to Arch Linux</a>
      </nav>
      <p>Software engineer passionate about building powerful, useful and open source systems. Thanks for dropping by! ðŸ’›</p>
      <div class="app-header-social">
        
          <a href="https://github.com/gucci-ninja" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-github" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
          </a>
        
          <a href="https://twitter.com/SuhaviSandhu" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-twitter" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>twitter</title><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
          </a>
        
          <a href="https://www.linkedin.com/in/suhavi/" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-linkedin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>linkedin</title><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Kafka Summit Tech Talk</h1>
      <div class="post-meta">
        <div>
          <svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Sep 16, 2021
        </div>
        <div>
          <svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          6 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>For those interested, I gave a talk at the Kafka APAC Summit in 2021 on how to leverage Kafka for decentralized applications. The video is still up on confluentâ€™s website but I went and added most of the topics I discussed here.</p>
<h2 id="what-is-a-decentralized-app-dapp">What is a decentralized app (DApp)</h2>
<p>Decentralized applications are programs that leverage a blockchain or peer-to-peer network to give users more control of their data. Decentralized applications are not really that new, you might have heard of some popular ones or even used them like BitTorrent. It uses the feeding and seeding model, where file sharing is made possible by users who volunteer to transfer their data to others and those users who propagate the data forwards by becoming seeders for the file.</p>
<p>In the case of blockchain, thereâ€™s a distributed ledger of blocks that are cryptographically hashed together. These blocks are filled with transactions that are governed by something called a smart contract. which is kind of like a binding agreement for your application. Usually there is also a front-end interface for users to make transactions for a small fee like if youâ€™re on the Ethereum network that would be ether. For a number of reasons, decentralized applications are transforming the way the internet works.</p>
<h2 id="popular-use-cases-for-dapps">Popular use cases for DApps</h2>
<p>Decentralized applications can be useful in industries where traceability and data integrity is very critical, like the supply chain or healthcare industry. Decentralized apps get rid of the need for a middle man in situations like voting day where you go cast your ballot and someone has to count it. There is also decentralized digital identity. For example, I recently learnend that they have started putting diplomas on a blockchain so they canâ€™t be forged as easily. Which is cool, instead of an expensive piece of paper I get a block on a chain. Quite possibly the most popular form of decentralized applications is cryptocurrency exchange where there is no central authority which makes it easy for traceability and audit-ability.</p>
<h2 id="pros-and-cons-of-dapps">Pros and Cons of DApps</h2>
<p>Pros</p>
<ul>
<li>Immutability - Once a transaction is made, it cannot be edited. This is possible today for all update models since data storage is relatively cheap compared to back in the day. It is possible to have an immutable audit trail of transactions, even if there are updates along the way.</li>
<li>Transparency - Instead of one central authority with our data it spans across multiple network of users, which means it is virtually impossible for fraudulent transactions to slip through.</li>
<li>Efficiency - Decentralized applications remove intermediaries which in turn reduces costs.</li>
</ul>
<p>Cons</p>
<ul>
<li>Transactions are slow - In a production environment, blockchain transactions can take upwards of five minutes, which can get really annoying.</li>
<li>High energy consumption - Each transaction made onto the blockchain requires compute through what is called â€˜miningâ€™, in order to verify and validate the transactions on each node. This is also called a consensus mechanism and contributes negatively to the environment.</li>
<li>Technical complexity - Managing private keys and interacting with decentralized systems can be complex for people with a non-technical background. There is also a lot of overhead investment needed for non-decentralized apps to follow a decentralized model once they have already taken off.</li>
</ul>
<h2 id="kafka-and-blockchain">Kafka and Blockchain</h2>
<p>After some research and playing around, I found that Kafka can solve some the problems. It gives us the speed, ability to ingest a lot of transactions at once and a way to replay all messages without adding unnecessary traffic to the blockchain. There are a lot of parallels between Kafka and the blockchain, for example the immutable commit log.</p>
<p>In this model, the kafka broker maintains communication with the user interface, the blockchain as well as the payment gateway. There are two active topics, one for unverified transactions and one for verified transactions.The goal is to keep them in sync.</p>
<h2 id="code">Code</h2>
<p>The full code can be found in this repository - <a href="https://github.com/gucci-ninja/KafkaSummitDemo">https://github.com/gucci-ninja/KafkaSummitDemo</a>.</p>
<p>The <code>patentrail-fe</code> folder is the front-end, built in React using bootstrap. It can be run against a kafka-blockchain backend and a non-kafka blockchain backend. It is agnostic of the underlying backend technology as long as they vend the same API contract. It is a patent registry that can <code>GET /patents</code> and <code>POST /patent</code>.</p>
<p>For development purposes , I run a local Ethereum blockchain using Ganache. There is a forced delay added to mimic a production network. When running locally, is is generally instantaneous. Ganache also provides test accounts or walllets.</p>
<p>To deploy the application rules to the blockchain, I created a smart contract in the <code>smart-contracts</code> folder. The smart contract tells the application what we can and canâ€™t do. The code below tells the blockchain that there is a Patent structure with an id, description and owner. Owner is an address that will map to the test account provided by Ganache.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Patents</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Patent</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">string</span> description;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">address</span> owner;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> numPatents <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">uint</span> <span style="color:#f92672">=&gt;</span> Patent) <span style="color:#66d9ef">public</span> patents;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">newPatent</span>(<span style="color:#66d9ef">string</span> <span style="color:#66d9ef">memory</span> _description) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>    patents[numPatents] <span style="color:#f92672">=</span> Patent(
</span></span><span style="display:flex;"><span>      numPatents,
</span></span><span style="display:flex;"><span>      _description,
</span></span><span style="display:flex;"><span>      msg.sender
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    numPatents<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  } 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I am also using truffle library to translate the smart contract into a meaningful API. It compiles the contract to JSON, which is how the back-end will understand the rules of our application. One thing to note is that every time the contract is updated, the records on the blockchain becomes invalid. So it is very important to have a solid contract before rolling it out onto a production environment.</p>
<p>First, I run the backend without kafka, in the <code>patentrail-be</code> folder. Adding a patent takes almost 10 seconds. Using a <a href="https://github.com/gucci-ninja/KafkaSummitDemo/blob/main/no-kafka-script.sh">script</a> that adds five patents back to back, it takes even longer for the patent to appear.</p>
<p>The next step is to switch over to the back-end implementation that leverages kafka (in folder <code>kafka-blockchain-be</code>). There are two topics, one for verified transactions and one for unverified. Transactions made by the user will immediately go into the unverified topic, whereas transactions will only be added to the verified topic once a receipt for verification is received from the blockchain.</p>
<p>To ensure that transactions donâ€™t get written to VERIFIED topic before UNVERIFIED, there is a check ensuring that VERIFIED topic is always in sync or at least behind UNVERIFIED topic.</p>
<p>The consumer listens to both topics. If there is a new unverified transaction, it gets added to the patents list. Once we get notified that it has been verified, we grab the patent and set verified to true.</p>
<p>After running the back-end that uses kafka, there are no patents available. That is because kafka is not synced with the blockchain. So, we perform a backfill.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span>module.exports.syncBlocks <span style="color:#f92672">=</span> async <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>  const numPatents <span style="color:#f92672">=</span> await PatentContract.methods.numPatents.call().call();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> numPatents; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    const patent <span style="color:#f92672">=</span> await PatentContract.methods.patents(i).call();
</span></span><span style="display:flex;"><span>    const buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Buffer.<span style="color:#66d9ef">from</span>(JSON.stringify(patent));
</span></span><span style="display:flex;"><span>    publish(buffer, constants.UNVERIFIED_TOPIC);
</span></span><span style="display:flex;"><span>    publish(i, constants.VERIFIED_TOPIC);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With this setup, we get an almost instantaneous settlement of transactions with the <code>Block added</code> status, which eventually conforms to <code>Verified</code> status.</p>
<h2 id="final-remarks">Final Remarks</h2>
<p>This model has a chance of working in a trustful environment. Still a long way to go until decentralized apps become the norm but until then we need to keep experimenting.</p>
<p>For the full talk - please check out <a href="https://www.confluent.io/ja-jp/events/kafka-summit-apac-2021/blockchain-and-kafka-a-modern-love-story/">https://www.confluent.io/ja-jp/events/kafka-summit-apac-2021/blockchain-and-kafka-a-modern-love-story/</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
